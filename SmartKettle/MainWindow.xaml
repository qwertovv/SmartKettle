<Window x:Class="SmartKettle.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Умный Чайник" Height="700" Width="1000">

    <Grid>
        <TabControl>
            <!-- Вкладка 1: Статус чайника -->
            <TabItem Header="Статус">
                <StackPanel Margin="10">
                    <GroupBox Header="Текущее состояние">
                        <StackPanel Margin="10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding KettleState.Status}" FontSize="16" FontWeight="Bold" Margin="5"/>
                                    <ProgressBar Value="{Binding KettleState.Temperature}" Maximum="100" Height="20" Margin="5"/>
                                    <TextBlock Text="{Binding KettleState.Temperature, StringFormat='Температура: {0}°C'}" Margin="5"/>
                                    <TextBlock Text="{Binding KettleState.WaterLevel, StringFormat='Уровень воды: {0} л'}" Margin="5"/>
                                    <TextBlock Text="{Binding KettleState.TargetTemperature, StringFormat='Целевая температура: {0}°C'}" Margin="5"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1">
                                    <CheckBox Content="Питание" IsChecked="{Binding KettleState.IsPowered}" Margin="5"/>
                                    <CheckBox Content="Нагрев" IsChecked="{Binding KettleState.IsHeating}" Margin="5"/>
                                    <Button Content="Начать нагрев" Margin="5" Height="30" Click="StartHeating_Click"/>
                                    <Button Content="Остановить" Margin="5" Height="30" Click="StopHeating_Click"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </GroupBox>
                </StackPanel>
            </TabItem>

            <!-- Вкладка 2: Контракты -->
            <TabItem Header="Контракты">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="200"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <ListBox Grid.Column="0" ItemsSource="{Binding ContractVM.Operations}" 
                            SelectedItem="{Binding ContractVM.SelectedOperation}" 
                            DisplayMemberPath="Name" Margin="5"/>

                    <StackPanel Grid.Column="1" Margin="10">
                        <GroupBox Header="Контракт операции">
                            <StackPanel Margin="10">
                                <TextBlock Text="{Binding ContractVM.SelectedOperation.Name}" FontSize="14" FontWeight="Bold" Margin="5"/>

                                <TextBlock Text="Предусловия:" FontWeight="Bold" Margin="5,10,5,0"/>
                                <TextBlock Text="{Binding ContractVM.SelectedOperation.PreConditions}" Margin="5" TextWrapping="Wrap"/>

                                <TextBlock Text="Постусловия:" FontWeight="Bold" Margin="5,10,5,0"/>
                                <TextBlock Text="{Binding ContractVM.SelectedOperation.PostConditions}" Margin="5" TextWrapping="Wrap"/>

                                <Button Content="Проверить предусловия" Margin="5" Height="30" Click="CheckPreConditions_Click"/>
                                <Button Content="Выполнить операцию" Margin="5" Height="30" Click="ExecuteOperation_Click"/>
                                <Button Content="Показать контракт" Margin="5" Height="30" Click="ShowContract_Click"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- Вкладка 3: WP-калькулятор -->
            <TabItem Header="WP-калькулятор">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                        <ComboBox x:Name="WPPresetsComboBox" ItemsSource="{Binding WPVM.Presets}" 
                                 Width="200" Margin="5" SelectionChanged="OnWPPresetChanged"/>
                    </StackPanel>

                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Margin="5">
                            <GroupBox Header="Исходный код">
                                <StackPanel Margin="5">
                                    <TextBox Text="{Binding WPVM.Code}" AcceptsReturn="True" Height="150"/>
                                </StackPanel>
                            </GroupBox>

                            <GroupBox Header="Цель (Post-condition)">
                                <StackPanel Margin="5">
                                    <TextBox Text="{Binding WPVM.PostCondition}" Height="60"/>
                                </StackPanel>
                            </GroupBox>

                            <Button Content="Рассчитать WP" Height="30" Margin="5" Click="CalculateWP_Click"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Margin="5">
                            <GroupBox Header="Пошаговый расчет">
                                <StackPanel Margin="5">
                                    <TextBox Text="{Binding WPVM.StepByStepTrace}" IsReadOnly="True" Height="100"/>
                                </StackPanel>
                            </GroupBox>

                            <GroupBox Header="Итоговое WP">
                                <StackPanel Margin="5">
                                    <TextBox Text="{Binding WPVM.FinalWP}" IsReadOnly="True" Height="60"/>
                                </StackPanel>
                            </GroupBox>

                            <GroupBox Header="Триада Хоара">
                                <StackPanel Margin="5">
                                    <TextBox Text="{Binding WPVM.HoareTriple}" IsReadOnly="True" Height="80"/>
                                </StackPanel>
                            </GroupBox>
                        </StackPanel>
                    </Grid>
                </Grid>
            </TabItem>

            <!-- Вкладка 4: Инварианты -->
            <TabItem Header="Инварианты">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="10">
                        <GroupBox Header="Цикл поддержания температуры">
                            <StackPanel Margin="10">
                                <!-- ИСПРАВЛЕНО: экранирование фигурных скобок и угловых скобок -->
                                <TextBlock Text="while (isHeating &amp;&amp; !stopRequested)" FontFamily="Consolas" Margin="5"/>
                                <TextBlock Text="{}{" FontFamily="Consolas" Margin="5,0,5,0"/>
                                
                                <TextBlock Text="    else if (temp > target + 2) heater = 0;" FontFamily="Consolas" Margin="20,0,5,0"/>
                                <TextBlock Text="{}}" FontFamily="Consolas" Margin="5,0,5,0"/>
                                <Button Content="Шаг цикла" Margin="5" Height="30" Click="ExecuteStep_Click"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Margin="10">
                        <GroupBox Header="Инвариант">
                            <StackPanel Margin="5">
                                <TextBox Text="{Binding InvariantVM.Invariant}" IsReadOnly="True" Height="60"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Вариант-функция">
                            <StackPanel Margin="5">
                                <TextBlock Text="{Binding InvariantVM.VariantFunction}" Margin="5"/>
                                <ProgressBar Value="{Binding InvariantVM.VariantValue}" Maximum="100" Height="20" Margin="5"/>
                                <TextBlock Text="{Binding InvariantVM.VariantValue, StringFormat='Текущее значение: {0}'}" Margin="5"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- Вкладка 5: Булевы функции -->
            <TabItem Header="Булевы функции">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                        <ComboBox x:Name="LogicPresetsComboBox" ItemsSource="{Binding BooleanVM.LogicPresets}" 
                                 Width="200" Margin="5"/>
                    </StackPanel>

                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Margin="5">
                            <GroupBox Header="Булево выражение">
                                <StackPanel Margin="5">
                                    <TextBox Text="{Binding BooleanVM.BooleanExpression}" Height="60"/>
                                </StackPanel>
                            </GroupBox>
                            <Button Content="Проверить эквивалентность" Margin="5" Height="30" Click="CheckEquivalence_Click"/>
                            <Button Content="Построить таблицу" Margin="5" Height="30" Click="CalculateTruthTable_Click"/>
                            <Button Content="Сгенерировать DNF/KNF" Margin="5" Height="30" Click="GenerateDNFKNF_Click"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Margin="5">
                            <GroupBox Header="Таблица истинности">
                                <StackPanel Margin="5">
                                    <TextBox Text="{Binding BooleanVM.TruthTable}" IsReadOnly="True" Height="150" FontFamily="Consolas"/>
                                </StackPanel>
                            </GroupBox>

                            <GroupBox Header="DNF">
                                <StackPanel Margin="5">
                                    <TextBox Text="{Binding BooleanVM.DNF}" IsReadOnly="True" Height="80" FontFamily="Consolas"/>
                                </StackPanel>
                            </GroupBox>

                            <GroupBox Header="KNF">
                                <StackPanel Margin="5">
                                    <TextBox Text="{Binding BooleanVM.KNF}" IsReadOnly="True" Height="80" FontFamily="Consolas"/>
                                </StackPanel>
                            </GroupBox>
                        </StackPanel>
                    </Grid>
                </Grid>
            </TabItem>
        </TabControl>
        <!-- Кнопка справки в нижнем правом углу -->
        <Button x:Name="HelpButton" 
            Content="?" 
            Width="30" 
            Height="30" 
            FontSize="16" 
            FontWeight="Bold"
            Background="#3498DB" 
            Foreground="White"
            BorderBrush="#2980B9"
            BorderThickness="1"
            HorizontalAlignment="Right" 
            VerticalAlignment="Bottom"
            Margin="0,0,10,10"
            Click="HelpButton_Click">
            <Button.Resources>
                <Style TargetType="Border">
                    <Setter Property="CornerRadius" Value="15"/>
                </Style>
            </Button.Resources>
        </Button>
    </Grid>
</Window>